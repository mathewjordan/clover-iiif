var Wo=Object.create;var Ze=Object.defineProperty;var jo=Object.getOwnPropertyDescriptor;var zo=Object.getOwnPropertyNames;var _o=Object.getPrototypeOf,Bo=Object.prototype.hasOwnProperty;var Uo=(t,e,r)=>e in t?Ze(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var qo=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Ho=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of zo(e))!Bo.call(t,o)&&o!==r&&Ze(t,o,{get:()=>e[o],enumerable:!(n=jo(e,o))||n.enumerable});return t};var Go=(t,e,r)=>(r=t!=null?Wo(_o(t)):{},Ho(e||!t||!t.__esModule?Ze(r,"default",{value:t,enumerable:!0}):r,t));var R=(t,e,r)=>(Uo(t,typeof e!="symbol"?e+"":e,r),r);var Tr=qo((Me,Er)=>{(function(t,e){typeof Me=="object"&&typeof Er!="undefined"?e(Me):typeof define=="function"&&define.amd?define(["exports"],e):e((t=t||self).TypesafeActions={})})(Me,function(t){"use strict";function e(c){return c==null}function r(c){throw new Error("Argument "+c+" is empty.")}function n(c){return typeof c=="function"&&"getType"in c}function o(c){throw new Error("Argument "+c+' is invalid, it should be an action-creator instance from "typesafe-actions"')}function i(c,u){if(c==null)throw new Error("Argument contains array with empty element at index "+u);if(c.getType==null)throw new Error("Argument contains array with invalid element at index "+u+', it should be an action-creator instance from "typesafe-actions"')}function a(c){return typeof c=="string"||typeof c=="symbol"}function s(c){return!a(c)}function l(c){throw new Error("Argument "+c+" is invalid, it should be an action type of type: string | symbol")}function p(c,u){if(c==null)throw new Error("Argument contains array with empty element at index "+u);if(typeof c!="string"&&typeof c!="symbol")throw new Error("Argument contains array with invalid element at index "+u+", it should be of type: string | symbol")}function y(c,u,m,b){return e(c)&&r(1),s(c)&&o(1),{type:c,payload:u,meta:m,error:b}}function h(c,u){return e(c)&&r(1),s(c)&&l(1),Object.assign(function(){var m=u!=null?u.apply(void 0,arguments):void 0;return Object.assign({type:c},m)},{getType:function(){return c},toString:function(){return c}})}function v(c,u,m){return e(c)&&r(1),s(c)&&l(1),function(){return h(c,function(){var b=arguments.length<=0?void 0:arguments[0],w=arguments.length<=1?void 0:arguments[1];return u==null&&m==null||(b=u!=null?u.apply(void 0,arguments):void 0,w=m!=null?m.apply(void 0,arguments):void 0),Object.assign({},b!==void 0&&{payload:b},{},w!==void 0&&{meta:w})})}}function x(c){return e(c)&&r(1),n(c)||o(1),c.getType()}function g(c,u){e(c)&&r(1),s(c)&&l(1);var m=u!=null?u(c):function(){return{type:c}};return Object.assign(m,{getType:function(){return c},toString:function(){return c}})}var C={createAction:function(c,u){var m=u==null?function(){return y(c)}:u(y.bind(null,c));return Object.assign(m,{getType:function(){return c},toString:function(){return c}})},createCustomAction:g,createStandardAction:function(c){return e(c)&&r(1),s(c)&&l(1),Object.assign(function(){return g(c,function(u){return function(m,b){return{type:u,payload:m,meta:b}}})},{map:function(u){return g(c,function(m){return function(b,w){return Object.assign(u(b,w),{type:m})}})}})}};t.action=y,t.createAction=v,t.createAsyncAction=function(c,u,m,b){return function(){var w=[c,u,m,b].map(function(S,W){return Array.isArray(S)?v(S[0],S[1],S[2])():typeof S=="string"||typeof S=="symbol"?v(S)():void(W<3&&function(ae){throw new Error("Argument "+ae+' is invalid, it should be an action type of "string | symbol" or a tuple of "[string | symbol, Function, Function?]"')}(W))});return{request:w[0],success:w[1],failure:w[2],cancel:w[3]}}},t.createCustomAction=h,t.createReducer=function c(u,m){m===void 0&&(m={});var b=Object.assign({},m),w=function(S,W){var ae=Array.isArray(S)?S:[S],qt={};return ae.map(function(se,$o){return n(se)?x(se):a(se)?se:function(Vo){throw new Error("Argument "+Vo+' is invalid, it should be an action-creator instance from "typesafe-actions" or action type of type: string | symbol')}($o+1)}).forEach(function(se){return qt[se]=W}),c(u,Object.assign({},b,{},qt))};return Object.assign(function(S,W){if(S===void 0&&(S=u),b.hasOwnProperty(W.type)){var ae=b[W.type];if(typeof ae!="function")throw Error('Reducer under "'+W.type+'" key is not a valid reducer');return ae(S,W)}return S},{handlers:Object.assign({},b),handleAction:w,handleType:w})},t.deprecated=C,t.getType=x,t.isActionOf=function(c,u){e(c)&&r(1);var m=Array.isArray(c)?c:[c];m.forEach(i);var b=function(w){return m.some(function(S){return w.type===S.getType()})};return u===void 0?b:b(u)},t.isOfType=function(c,u){e(c)&&r(1);var m=Array.isArray(c)?c:[c];m.forEach(p);var b=function(w){return m.includes(w.type)};return u===void 0?b:b(u)}})});import q,{useEffect as Ke,useState as Do}from"react";import oe from"react";var f=[];Object.freeze(f);var Qo={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:f,motivation:null,label:null,thumbnail:f,summary:null,requiredStatement:null,metadata:f,rights:null,provider:f,items:f,seeAlso:f,homepage:f,logo:f,rendering:f,service:f},Yo={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:f,motivation:null,thumbnail:f,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:f,rights:null,navDate:null,provider:f,items:f,annotations:f,seeAlso:f,homepage:f,logo:f,partOf:f,rendering:f,service:f,duration:0,height:0,width:0},Ko={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:f,motivation:null,thumbnail:f,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:f,rights:null,navDate:null,provider:f,items:f,annotations:f,seeAlso:f,homepage:f,logo:f,partOf:f,rendering:f,service:f,services:f},Zo={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:f,behavior:f,homepage:f,items:f,label:null,logo:f,metadata:f,motivation:null,navDate:null,provider:f,partOf:f,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:f,requiredStatement:null,rights:null,seeAlso:f,service:f,services:f,start:null,structures:f,summary:null,thumbnail:f,viewingDirection:"left-to-right"},Xo={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:f,motivation:null,thumbnail:f,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:f,rights:null,navDate:null,provider:f,items:f,annotations:f,seeAlso:f,homepage:f,logo:f,partOf:f,rendering:f,service:f,start:null,supplementary:null,viewingDirection:"left-to-right"},Jo={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:f,seeAlso:f,homepage:f};function Je(t){return Array.isArray(t)?t:[t]}var Ht=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function ei(t){if(typeof t=="undefined"||t===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(t))throw new Error("Array is not a valid entity");if(typeof t!="object")throw new Error(`${typeof t} is not a valid entity`);if(typeof t.type=="string"){let e=Ht.indexOf(t.type);if(e!==-1)return Ht[e]}if(t.profile)return"Service";throw new Error("Resource type is not known")}var ye=class{constructor(e,r={}){R(this,"traversals");R(this,"options");this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...e},this.options={allowUndefinedReturn:!1,...r}}static all(e){return new ye({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=e.thumbnail.map(r=>this.traverseType(r,this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(r=>this.traverseAgent(r))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map(r=>this.traverseType(r,this.traversals.contentResource))),e.service&&(e.service=Je(e.service).map(r=>this.traverseType(r,this.traversals.service))),e.services&&(e.services=e.services.map(r=>this.traverseType(r,this.traversals.service))),e.logo&&(e.logo=e.logo.map(r=>this.traverseType(r,this.traversals.contentResource))),e.homepage&&(e.homepage=e.homepage.map(r=>this.traverseType(r,this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(r=>typeof r=="string"||!r.type?this.traverseType(r,this.traversals.contentResource):r.type==="Canvas"?this.traverseType(r,this.traversals.canvas):r.type==="AnnotationCollection"?this.traverseType(r,this.traversals.annotationCollection):this.traverseType(r,this.traversals.contentResource))),e.start&&(e.start=e.start?this.traverseType(e.start,this.traversals.canvas):null),e.rendering&&(e.rendering=e.rendering.map(r=>this.traverseType(r,this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(r=>this.traverseType(r,this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(r=>r.type==="Collection"?this.traverseCollection(r):this.traverseManifest(r)),e}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(e))))),this.traversals.collection)}traverseManifestItems(e){return e.items&&(e.items=e.items.map(r=>this.traverseCanvas(r))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(r=>this.traverseRange(r))),e}traverseManifest(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e)))))),this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(r=>this.traverseAnnotationPage(r)),e}traverseInlineAnnotationPages(e){return typeof e=="string"||!e||e.annotations&&(e.annotations=e.annotations.map(r=>this.traverseAnnotationPage(r))),e}traverseCanvas(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))))),this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(r=>this.traverseAnnotation(r))),e}traverseAnnotationPage(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(e))),this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(r=>this.traverseContentResource(r)):e.body&&(e.body=this.traverseContentResource(e.body)),e}traversePosterCanvas(e){return e.posterCanvas&&(e.posterCanvas=this.traverseCanvas(e.posterCanvas)),e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(e)),this.traversals.annotation)}traverseContentResourceLinking(e){return typeof e=="string"||!e||e&&e.service&&(e.service=Je(e.service||[]).map(r=>this.traverseType(r,this.traversals.service))),e}traverseContentResource(e){return e.type==="Choice"&&(e.items=e.items.map(r=>this.traverseContentResource(r))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),this.traversals.contentResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(r=>typeof r=="string"?this.traverseCanvas({id:r,type:"Canvas"}):r.type==="Manifest"?this.traverseManifest(r):this.traverseRange(r))),e}traverseRange(e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(e)))),this.traversals.range)}traverseAgent(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.agent)}traverseType(e,r){return r.reduce((n,o)=>{let i=o(n);return typeof i=="undefined"&&!this.options.allowUndefinedReturn?n:i},e)}traverseService(e){return this.traverseType(e,this.traversals.service)}traverseUnknown(e){let r=ei(e);switch(r){case"Collection":return this.traverseCollection(e);case"Manifest":return this.traverseManifest(e);case"Canvas":return this.traverseCanvas(e);case"AnnotationPage":return this.traverseAnnotationPage(e);case"Annotation":return this.traverseAnnotation(e);case"ContentResource":return this.traverseContentResource(e);case"Range":return this.traverseRange(e);case"Service":return this.traverseService(e);case"Agent":return this.traverseAgent(e);default:throw new Error(`Unknown or unsupported resource type of ${r}`)}}},Gt=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function ti(t){if(typeof t=="undefined"||t===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(t))throw new Error("Array is not a valid entity");if(typeof t!="object")throw new Error(`${typeof t} is not a valid entity`);if(typeof t["@type"]=="string"){let e=Gt.indexOf(t["@type"]);if(e!==-1)return Gt[e]}if(t.profile)return"Service";if(t.format||t["@type"])return"ContentResource";throw new Error("Resource type is not known")}var ve=class{constructor(e,r={}){R(this,"traversals");R(this,"options");this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...r}}static all(e){return new ve({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let r=[...(e.manifests||[]).map(n=>typeof n=="string"?{"@id":n,"@type":"sc:Manifest"}:n),...(e.collections||[]).map(n=>typeof n=="string"?{"@id":n,"@type":"sc:Collection"}:n),...e.members||[]];delete e.collections,delete e.manifests,e.members=r}return e.manifests&&(e.manifests=e.manifests.map(r=>this.traverseManifest(typeof r=="string"?{"@id":r,"@type":"sc:Manifest"}:r))),e.collections&&(e.collections=e.collections.map(r=>this.traverseCollection(typeof r=="string"?{"@id":r,"@type":"sc:Collection"}:r))),e.members&&(e.members=e.members.map(r=>typeof r=="string"?r:this.traverseUnknown(r))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(r=>this.traverseSequence(r))),e.structures&&(e.structures=e.structures.map(r=>this.traverseRange(r))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(r=>this.traverseCanvas(r))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(r=>this.traverseAnnotation(r))),e.otherContent&&(e.otherContent=e.otherContent.map(r=>this.traverseAnnotationList(r))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let r=[...(e.ranges||[]).map(n=>typeof n=="string"?{"@id":n,"@type":"sc:Range"}:n),...(e.canvases||[]).map(n=>typeof n=="string"?{"@id":n,"@type":"sc:Canvas"}:n),...e.members||[]];delete e.ranges,delete e.canvases,e.members=r.length?r.map(n=>this.traverseUnknown(n)):void 0}return e}traverseAnnotationList(e){let r=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(r)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(r=>this.traverseAnnotation(r))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(r=>this.traverseAnnotationList(r))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(r=>this.traverseContentResource(r))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(ti(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let r=Array.isArray(e),n=Array.isArray(e)?e:[e],o=[];for(let i of n)typeof i=="string"?o.push(this.traverseContentResource({"@id":i,"@type":"dctypes:Image"})):o.push(this.traverseContentResource(i));return!r&&!this.options.convertPropsToArray?o[0]:o}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let r=Array.isArray(e),n=Array.isArray(e)?e:[e],o=[];for(let i of n)o.push(this.traverseService(i));return!r&&!this.options.convertPropsToArray?o[0]:o}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,r){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,r);return e.map(n=>this.traverseType(n,r))}traverseType(e,r){return r.reduce((n,o)=>{let i=o(n);return typeof i=="undefined"&&!this.options.allowUndefinedReturn?n:i},e)}},ri="http://library.stanford.edu/iiif/image-api/compliance.html#level0",Kt="http://library.stanford.edu/iiif/image-api/compliance.html#level1",Zt="http://library.stanford.edu/iiif/image-api/compliance.html#level2",ni="http://library.stanford.edu/iiif/image-api/conformance.html#level0",Xt="http://library.stanford.edu/iiif/image-api/conformance.html#level1",Jt="http://library.stanford.edu/iiif/image-api/conformance.html#level2",oi="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",er="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",tr="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",ii="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",rr="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",nr="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",ai="http://iiif.io/api/image/1/level0.json",si="http://iiif.io/api/image/1/profiles/level0.json",or="http://iiif.io/api/image/1/level1.json",ir="http://iiif.io/api/image/1/profiles/level1.json",ar="http://iiif.io/api/image/1/level2.json",sr="http://iiif.io/api/image/1/profiles/level2.json",li="http://iiif.io/api/image/2/level0.json",ci="http://iiif.io/api/image/2/profiles/level0.json",lr="http://iiif.io/api/image/2/level1.json",cr="http://iiif.io/api/image/2/profiles/level1.json",ur="http://iiif.io/api/image/2/level2.json",dr="http://iiif.io/api/image/2/profiles/level2.json",ui="level0",pr="level1",fr="level2",di="http://iiif.io/api/image/2/level0",mr="http://iiif.io/api/image/2/level1",hr="http://iiif.io/api/image/2/level2",pi=[mr,hr,Kt,Zt,Xt,Jt,er,tr,rr,nr,or,ir,ar,sr,lr,cr,ur,dr,pr,fr],fi=[di,mr,hr,ri,Kt,Zt,ni,Xt,Jt,oi,er,tr,ii,rr,nr,ai,si,or,ir,ar,sr,li,ci,lr,cr,ur,dr,ui,pr,fr],et={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function ne(t,e="none"){if(!t)return{};let r=Array.isArray(t)?t:[t],n={};for(let o of r){if(typeof o=="string"){n[e]=n[e]?n[e]:[],n[e].push(o||"");continue}if(!o["@language"]){n[e]=n[e]?n[e]:[],n[e].push(o["@value"]||"");continue}let i=o["@language"];n[i]=n[i]?n[i]:[],n[i].push(o["@value"]||"")}return n}function gr(t){if(Array.isArray(t))return gr(t.find(e=>typeof e=="string"));if(fi.indexOf(t)!==-1)return"level2";if(pi.indexOf(t)!==-1)return"level1";if(typeof t=="string")return t}function mi(t){let e=Array.isArray(t)?t:[t];for(let r of e)switch(r){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function hi(t){switch(t){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function gi(t){for(let e of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${e}:`))return t.slice(e.length+1);return t}var yi=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function rt(t){let e=t["@id"]||t.id,r=t["@type"]||t.type,n=t.profile||void 0,o=t["@context"]||void 0;if(n){let i=hi(n);if(i)return i}if(o){let i=mi(o);if(i)return i}if(r){if(Array.isArray(r)){if(r.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(r.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";r=r[0]}for(let i of["sc","oa","dcterms","dctypes","iiif"])if(r.startsWith(`${i}:`)){r=r.slice(i.length+1);break}switch(r){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(r&&yi.indexOf(r)!==-1)return r;if(t.format){if(t.format.startsWith("image/"))return"Image";if(t.format.startsWith("text/")||t.format==="application/pdf")return"Text";if(t.format.startsWith("application/"))return"Dataset"}return e&&(e.endsWith(".jpg")||e.endsWith(".png")||e.endsWith(".jpeg"))?"Image":r||"unknown"}var vi=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function bi(t){let e=t.match(vi);return e?e[0]:t}function Ci(t,e="Rights/License",r="none"){let n=null,o=[],i=Array.isArray(t)?t:[t];for(let a of i){let s=a?bi(a):void 0;if(s&&(s.indexOf("creativecommons.org")!==-1||s.indexOf("rightsstatements.org")!==-1)){s.startsWith("https://")?n=`http://${s.slice(8)}`:n=s;continue}s&&o.push({label:{[r]:[e]},value:{[r]:[s]}})}return[n,o]}var xi=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function wi(t){if(t){let e=Array.isArray(t)?t:[t],r=[];for(let n of e)n==="http://iiif.io/api/presentation/2/context.json"&&r.push("http://iiif.io/api/presentation/3/context.json"),xi.indexOf(n)===-1&&r.push(n);if(e.length)return r.length===1?r[0]:r}}function Ii(t){return t?t.map(e=>({label:ne(e.label),value:ne(e.value)})):[]}function j(t){for(let e in t)(typeof t[e]=="undefined"||t[e]===null)&&delete t[e];return t}var Qt=0;function yr(t,e){let r=encodeURI(t.id||t["@id"]||"").trim();return r&&e?`${r}/${e}`:r||(Qt++,`http://example.org/${t["@type"]}${e?`/${e}`:""}/${Qt}`)}function z(t){let e=[...t.behavior||[]];return t.viewingHint&&e.push(t.viewingHint),{"@context":t["@context"]?wi(t["@context"]):void 0,id:(t["@id"]||yr(t)).trim(),type:rt(t),behavior:e.length?e:void 0,height:t.height?t.height:void 0,width:t.width?t.width:void 0,motivation:t.motivation?gi(t.motivation):void 0,viewingDirection:t.viewingDirection,profile:t.profile,format:t.format?t.format:void 0,duration:void 0,timeMode:void 0}}function _(t){let[e,r]=Ci(t.license),n=[...t.metadata?Ii(t.metadata):[],...r];return{rights:e,metadata:n.length?n:void 0,label:t.label?ne(t.label):void 0,requiredStatement:t.attribution?{label:ne(et.attributionLabel),value:ne(t.attribution)}:void 0,navDate:t.navDate,summary:t.description?ne(t.description):void 0,thumbnail:t.thumbnail}}function Si(t){if(!t.within)return;let e=Array.isArray(t.within)?t.within:[t.within],r=[];for(let n of e)if(typeof n=="string"){if(n)switch(t["@type"]){case"sc:Manifest":r.push({id:n,type:"Collection"});break}}else n["@id"]&&r.push({id:n["@id"],type:rt(n)});return r.length?r:void 0}function G(t){let e=t.related?Array.isArray(t.related)?t.related:[t.related]:[],r=t.contentLayer;return{provider:t.logo||e.length?[{id:et.providerId,type:"Agent",homepage:e.length?[e[0]]:void 0,logo:t.logo?Array.isArray(t.logo)?t.logo:[t.logo]:void 0,label:ne(et.providerName)}]:void 0,partOf:Si(t),rendering:t.rendering,seeAlso:t.seeAlso,start:t.startCanvas,service:t.service?Je(t.service):void 0,supplementary:r?[r]:void 0}}function Ai(t){return j({...z(t),..._(t),...G(t),items:t.members})}function Ei(t){let e=[],r=[];for(let o of t.sequences||[])o.canvases.length&&e.push(...o.canvases),o.behavior&&r.push(...o.behavior);let n=z(t);return r.length&&(n.behavior?n.behavior.push(...r):n.behavior=r),j({...n,..._(t),...G(t),items:e,structures:t.structures})}function Ti(t){return j({...z(t),..._(t),...G(t),annotations:t.otherContent&&t.otherContent.length?t.otherContent:void 0,items:t.images&&t.images.length?[{id:yr(t,"annotation-page"),type:"AnnotationPage",items:t.images}]:void 0})}function ki(t){return j({...z(t),..._(t),...G(t),items:t.resources&&t.resources.length?t.resources:void 0})}function Pi(t){return!t.canvases||t.canvases.length===0?{canvases:[],behavior:[]}:{canvases:t.canvases,behavior:t.viewingHint?[t.viewingHint]:[]}}function Mi(t){return j({...z(t),..._(t),...G(t),target:typeof t.on=="string"?encodeURI(t.on).trim():t.on,body:t.resource})}function Oi(t){let e=t;return j({...z(e),..._(e),...G(e)})}function Ri(t){let e=[];return t.default&&t.default!=="rdf:nil"&&e.push(t.default),t.item&&t.item!=="rdf:nil"&&e.push(...t.item),{...z(t),..._(t),items:e}}function Ni(t){return j({...z(t),..._(t),...G(t),items:t.members})}function Li(t){let{"@id":e,"@type":r,"@context":n,profile:o,...i}=t,a={};return e&&(a["@id"]=e),a["@type"]=rt(t),a["@type"]==="unknown"&&(n&&n.length&&(a["@context"]=n),a["@type"]="Service"),o&&(a.profile=gr(o)),j({...a,...i})}function Fi(t){return j({...z(t),..._(t),...G(t)})}var Di=new ve({collection:[Ai],manifest:[Ei],canvas:[Ti],annotationList:[ki],sequence:[Pi],annotation:[Mi],contentResource:[Oi],choice:[Ri],range:[Ni],service:[Li],layer:[Fi]});function $i(t){return t&&t["@context"]&&(t["@context"]==="http://iiif.io/api/presentation/2/context.json"||t["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||t["@context"]==="http://www.shared-canvas.org/ns/context.json")||t["@context"]==="http://iiif.io/api/image/2/context.json"?Di.traverseUnknown(t):t}function Vi(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function vr(t,e){if(typeof t=="string")return{id:t,type:e};if(!t.id)throw new Error(`Invalid resource does not have an ID (${e})`);return t}function Wi(t){return(e,r)=>{let n=t[e]?t[e]:{};return o=>{let i=vr(o,r||e);return i&&i.id&&e?(n[i.id]=n[i.id]?ji(n[i.id],i):Object.assign({},i),{id:i.id,type:e==="ContentResource"?e:i.type}):i}}}function tt(t,e){if(!e)return t;if(Array.isArray(t)){if(!Array.isArray(e))throw new Error("Cannot merge array with non-array");let r=[...t];for(let n of e)if(n!=null)if(Array.isArray(n))r.push(n);else if(typeof n=="object"&&n.id&&n.type){let o=r.findIndex(i=>i.id===n.id&&i.type===n.type);o>=0&&(r[o]=tt(r[o],n))}else t.indexOf(n)===-1&&r.push(n);return r}else if(typeof t=="object"){if(Array.isArray(e)||typeof e!="object")throw new Error("Cannot merge object with non-object");let r={...t};for(let[n,o]of Object.entries(e)){let i=r[n];i===f||!i?r[n]=o:r[n]=tt(i,o)}return r}else if(t)return t;return e}function ji(t,e){if(typeof t=="string")return t;if(e.id!==t.id||e.type!==t.type)throw new Error("Can only merge entities with identical identifiers and type!");return tt({...t},e)}function zi(t){return(e,r)=>n=>{let{id:o,type:i}=vr(n,r||e);if(typeof o=="undefined")throw new Error("Found invalid entity without an ID.");return e==="ContentResource"?t[o]=e:t[o]=i,n}}function _i(t){let e=JSON.stringify(t),r=5381,n=e.length;for(;n;)r=r*33^e.charCodeAt(--n);let o=(r>>>0).toString(16);return o.length%2?"0"+o:o}function Xe(t){return e=>typeof e=="string"?{id:e,type:t}:e.id?e.type?e:{type:t,...e}:{id:`vault://${_i(e)}`,type:t,...e}}function le(t){return e=>({...t,...e})}function ce(t){return Array.isArray(t)?t:[t]}function Bi(t){return t.body&&(t.body=ce(t.body)),t.seeAlso&&(t.seeAlso=ce(t.seeAlso)),t.body&&(t.body=ce(t.body)),t.audience&&(t.audience=ce(t.audience)),t.accessibility&&(t.accessibility=ce(t.accessibility)),t.motivation&&(t.motivation=ce(t.motivation)),t}function br(t){let e=$i(t),r=Vi(),n={},o=Wi(r),i=zi(n),a=new ye({collection:[le(Ko),i("Collection"),o("Collection")],manifest:[le(Zo),i("Manifest"),o("Manifest")],canvas:[le(Yo),i("Canvas"),o("Canvas")],annotationPage:[Xe("AnnotationPage"),le(Qo),i("AnnotationPage"),o("AnnotationPage")],annotation:[Xe("Annotation"),Bi,i("Annotation"),o("Annotation")],contentResource:[Xe("ContentResource"),i("ContentResource"),o("ContentResource")],range:[le(Xo),i("Range","Canvas"),o("Range","Canvas")],agent:[le(Jo),i("Agent"),o("Agent")]}).traverseUnknown(e);return{entities:r,resource:a,mapping:n}}var re="__$UNSET$__",Cr="__$UNWRAP$__";function Ui(t,e){let r=t.requests[e],n=t.mapping[e];if(!(!n||r&&r.resourceUri&&!t.entities[n][r.resourceUri]))return t.entities[n][r?r.resourceUri:e]}function qi(t){let e={};for(let[r,n]of t){if(r===Cr&&n!==re)return n;n!==re&&typeof n!="undefined"&&n!==null&&(e[r]=n)}return e}function xr(t,e,r){if(!e.type||!e.id)throw new Error("Unknown entity");if(!r[e.type])throw new Error(`Serializer not found for ${e.type}`);function n(o){let i=r[o.type];if(!i)return re;let a=Ui(t,o.id)||(o.id&&o.type?o:null);if(!a)return re;let s=i(a,t,{isTopLevel:e.id===o.id}),l=s.next();for(;!l.done;){let p=l.value,y=re;if(p)if(Array.isArray(p)){let h=[];for(let v of p)h.push(n(v));y=h}else y=n(p);l=s.next(y)}return l.value===re?re:qi(l.value)}return n(e)}function ue(t){if(!t)return;let e=Object.keys(t);if(e.length!==0){if(e.length===1){let r=e[0];if(!r)return"";let n=(t[r]||[]).join("");return r==="@none"||r==="none"||r==="en"?n:{"@language":r,"@value":n}}return e.map(r=>({"@language":r,"@value":(t[r]||[]).join("")}))}}function wr(t){return Array.isArray(t)?t.map(e=>wr(e)):typeof t=="string"?t:t.type&&t.type==="Canvas"?t.id:t}function H(t,e=!1){if(t)return t.length>1&&!e?t:t[0]||void 0}function Hi(t){if(t){if(typeof t=="string")return{"@id":t};if("@id"in t){let e={...t};return delete e["@type"],e}return{"@context":"http://iiif.io/api/image/2/context.json","@id":t.id,profile:`http://iiif.io/api/image/2/profiles/${t.profile}.json`}}}function Z(t,e){return[["@id",t.id],["@type",e],["format",t.format],["height",t.height],["width",t.width],["viewingDirection",t.viewingDirection!=="left-to-right"?t.viewingDirection:void 0]]}function*X(t){let e=t.provider?yield t.provider[0]:void 0;return[["label",ue(t.label)],["metadata",t.metadata&&t.metadata.length?t.metadata.map(r=>({label:ue(r.label)||"",value:ue(r.value)||""})):void 0],["description",ue(t.summary)],["thumbnail",H(yield t.thumbnail)],["navDate",t.navDate],["logo",e?H(e.logo):void 0],["homepage",e?e.homepage:void 0],["attribution",t.requiredStatement?ue(t.requiredStatement.value):void 0]]}function*ge(t){return[["seeAlso",H(yield t.seeAlso)],["service",H((t.service||[]).map(Hi))],["rendering",H(yield t.rendering)],["startCanvas",t.start?t.start.id:void 0]]}var Ir={Manifest:function*(t){return[...Z(t,"sc:Manifest"),...yield*X(t),...yield*ge(t),["sequences",[{"@id":`${t.id}/sequence0`,"@type":"sc:Sequence",canvases:yield t.items}]],["structures",yield t.structures]]},Canvas:function*(t){let e=(yield t.items)[0];return[...Z(t,"sc:Canvas"),...yield*X(t),...yield*ge(t),["images",e?[e.resources]:void 0],["annotations",t.annotations&&t.annotations.length?H(yield t.annotations):void 0]]},AnnotationPage:function*(t){return[...Z(t,"sc:AnnotationList"),...yield*X(t),["resources",t.items&&t.items.length?H(yield t.items):void 0]]},Annotation:function*(t){return[["@id",t.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",wr(t.target)],["resource",H(yield t.body,!0)]]},ContentResource:function*(t){switch(t.type){case"Image":return[...Z(t,"dctypes:Image"),...yield*X(t),...yield*ge(t)];case"Text":case"Dataset":default:return[...Z(t,void 0),...yield*X(t)]}},AnnotationCollection:function*(t){return[["@id",t.id],["@type","sc:Layer"],["label",ue(t.label)]]},Collection:function*(t){return[...Z(t,"sc:Collection"),...yield*X(t),...yield*ge(t),["members",yield*t.items]]},Range:function*(t){let e=[],r=[];if(t.items)for(let n of t.items){let o=yield n;e.push({"@id":n.id,"@type":n.type,label:o?o.label:void 0,within:t.id}),n.type==="Canvas"&&r.push(n.id)}return[...Z(t,"sc:Range"),...yield*X(t),...yield*ge(t),["canvases",r.length===e.length?r:void 0],["members",r.length!==e.length?e:void 0]]}};function J(t){var e;return[["id",(e=t.id)!=null&&e.startsWith("vault://")?void 0:t.id],["type",t.type],["format",t.format],["profile",t.profile],["height",t.height],["width",t.width],["duration",t.duration||void 0],["viewingDirection",t.viewingDirection!=="left-to-right"?t.viewingDirection:void 0],["behavior",t.behavior&&t.behavior.length?t.behavior:void 0],["timeMode",t.timeMode],["motivation",Array.isArray(t.motivation)?t.motivation[0]:t.motivation]]}function E(t){if(!(!t||t.length===0))return t}function Sr(t){if(t&&t.type&&t.type==="ImageService2"){let{id:e,type:r,profile:n,...o}=t,i=typeof n=="string"?n:Array.isArray(n)?n.find(a=>typeof a=="string"):"";return{"@id":e,"@type":r,profile:i?i.startsWith("http")?i:`http://iiif.io/api/image/2/${i}.json`:"http://iiif.io/api/image/2/level0.json",...o}}return t}function Yt(t){if(!(!t||t.length===0))return t.map(Sr)}function*ee(t){return[["label",t.label],["metadata",E(t.metadata)],["summary",t.summary],["requiredStatement",t.requiredStatement],["rights",t.rights],["navDate",t.navDate],["language",t.language],["thumbnail",E(yield t.thumbnail)],["placeholderCanvas",yield t.placeholderCanvas],["accompanyingCanvas",yield t.accompanyingCanvas],["provider",E(yield t.provider)]]}function*te(t){return[["seeAlso",E(yield t.seeAlso)],["service",Yt(t.service)],["services",Yt(t.services)],["rendering",E(yield t.rendering)],["supplementary",E(yield t.supplementary)],["homepage",E(yield t.homepage)],["logo",E(yield t.logo)],["partOf",E(yield t.partOf)],["start",t.start]]}var Ar={Manifest:function*(t,e,{isTopLevel:r}){return r?[["@context","http://iiif.io/api/presentation/3/context.json"],...J(t),...yield*ee(t),...yield*te(t),["items",yield t.items],["structures",E(yield t.structures)],["annotations",E(yield t.annotations)]]:[...J(t),...yield*ee(t)]},Canvas:function*(t){return[...J(t),...yield*ee(t),...yield*te(t),["items",yield t.items],["annotations",E(yield t.annotations)]]},Agent:function*(t){return[["id",t.id],["type","Agent"],["label",t.label],...yield*te(t)]},AnnotationPage:function*(t){return[...Object.entries(t).map(([e,r])=>[e,Array.isArray(r)?E(r):r]).filter(([e,r])=>e!=="items"),...yield*te(t),["items",yield t.items]]},Service:function*(t){return[[Cr,Sr(t)]]},Annotation:function*(t){let e=Object.entries(t).map(([n,o])=>n==="motivation"?[n,Array.isArray(o)?o[0]:o]:[n,Array.isArray(o)?E(o):o]).filter(([n])=>n!=="body"),r=yield t.body;return[...e,["body",r.length===1?r[0]:r]]},ContentResource:function*(t){return[...J(t),...yield*ee(t),...yield*te(t),["annotations",E(yield t.annotations)],["items",E(yield t.items)]]},AnnotationCollection:function*(t){return[["id",t.id],["type","AnnotationCollection"],["label",t.label]]},Collection:function*(t,e,{isTopLevel:r}){return r?[["@context","http://iiif.io/api/presentation/3/context.json"],...J(t),...yield*ee(t),...yield*te(t),["items",E(yield t.items)]]:[...J(t),...yield*ee(t)]},Range:function*(t){let e=[];for(let r of t.items)r.type==="Range"?e.push(yield r):e.push(r);return[...J(t),...yield*ee(t),...yield*te(t),["items",e],["annotations",E(yield t.annotations)]]}};var T=Go(Tr(),1);function nt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function kr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function Oe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kr(Object(r),!0).forEach(function(n){nt(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kr(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function M(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var Pr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),ot=function(){return Math.random().toString(36).substring(7).split("").join(".")},Re={INIT:"@@redux/INIT"+ot(),REPLACE:"@@redux/REPLACE"+ot(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ot()}};function Gi(t){if(typeof t!="object"||t===null)return!1;for(var e=t;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function it(t,e,r){var n;if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(M(0));if(typeof e=="function"&&typeof r=="undefined"&&(r=e,e=void 0),typeof r!="undefined"){if(typeof r!="function")throw new Error(M(1));return r(it)(t,e)}if(typeof t!="function")throw new Error(M(2));var o=t,i=e,a=[],s=a,l=!1;function p(){s===a&&(s=a.slice())}function y(){if(l)throw new Error(M(3));return i}function h(C){if(typeof C!="function")throw new Error(M(4));if(l)throw new Error(M(5));var c=!0;return p(),s.push(C),function(){if(!!c){if(l)throw new Error(M(6));c=!1,p();var m=s.indexOf(C);s.splice(m,1),a=null}}}function v(C){if(!Gi(C))throw new Error(M(7));if(typeof C.type=="undefined")throw new Error(M(8));if(l)throw new Error(M(9));try{l=!0,i=o(i,C)}finally{l=!1}for(var c=a=s,u=0;u<c.length;u++){var m=c[u];m()}return C}function x(C){if(typeof C!="function")throw new Error(M(10));o=C,v({type:Re.REPLACE})}function g(){var C,c=h;return C={subscribe:function(m){if(typeof m!="object"||m===null)throw new Error(M(11));function b(){m.next&&m.next(y())}b();var w=c(b);return{unsubscribe:w}}},C[Pr]=function(){return this},C}return v({type:Re.INIT}),n={dispatch:v,subscribe:h,getState:y,replaceReducer:x},n[Pr]=g,n}function Qi(t){Object.keys(t).forEach(function(e){var r=t[e],n=r(void 0,{type:Re.INIT});if(typeof n=="undefined")throw new Error(M(12));if(typeof r(void 0,{type:Re.PROBE_UNKNOWN_ACTION()})=="undefined")throw new Error(M(13))})}function at(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n];typeof t[o]=="function"&&(r[o]=t[o])}var i=Object.keys(r),a,s;try{Qi(r)}catch(l){s=l}return function(p,y){if(p===void 0&&(p={}),s)throw s;if(!1)var h;for(var v=!1,x={},g=0;g<i.length;g++){var C=i[g],c=r[C],u=p[C],m=c(u,y);if(typeof m=="undefined"){var b=y&&y.type;throw new Error(M(14))}x[C]=m,v=v||m!==u}return v=v||i.length!==Object.keys(p).length,v?x:p}}function be(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===0?function(n){return n}:e.length===1?e[0]:e.reduce(function(n,o){return function(){return n(o.apply(void 0,arguments))}})}function st(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(n){return function(){var o=n.apply(void 0,arguments),i=function(){throw new Error(M(15))},a={getState:o.getState,dispatch:function(){return i.apply(void 0,arguments)}},s=e.map(function(l){return l(a)});return i=be.apply(void 0,s)(o.dispatch),Oe(Oe({},o),{},{dispatch:i})}}}var Lr="@iiif/IMPORT_ENTITIES",Fr="@iiif/MODIFY_ENTITY_FIELD",Dr="@iiif/REORDER_ENTITY_FIELD",$r="@iiif/ADD_REFERENCE",Vr="@iiif/REMOVE_REFERENCE",Wr=(0,T.createAction)(Lr)(),Yi=(0,T.createAction)(Fr)(),Ki=(0,T.createAction)(Dr)(),Zi=(0,T.createAction)($r)(),Xi=(0,T.createAction)(Vr)(),Ji={importEntities:Wr,modifyEntityField:Yi,reorderEntityField:Ki,addReference:Zi,removeReference:Xi},jr="@iiif/ADD_MAPPING",zr="@iiif/ADD_MAPPINGS",ea=(0,T.createAction)(jr)(),ta=(0,T.createAction)(zr)(),_r="@iiif/SET_META_VALUE",Br="@iiif/SET_META_VALUE_DYNAMIC",Ur="@iiif/UNSET_META_VALUE",ra=(0,T.createAction)(_r)(),na=(0,T.createAction)(Br)(),oa=(0,T.createAction)(Ur)(),Mr={setMetaValue:ra,setMetaValueDynamic:na,unsetMetaValue:oa},ut="RESOURCE_ERROR",qr="RESOURCE_LOADING",dt="RESOURCE_READY",Hr="@iiif/REQUEST_RESOURCE",Gr="@iiif/REQUEST_ERROR",Qr="@iiif/REQUEST_MISMATCH",Yr="@iiif/REQUEST_COMPLETE",Kr="@iiif/REQUEST_OFFLINE_RESOURCE",ia=(0,T.createAction)(Hr)(),Zr=(0,T.createAction)(Gr)(),aa=(0,T.createAction)(Qr)(),sa=(0,T.createAction)(Yr)();(0,T.createAction)(Kr)();var ft="@iiif/BATCH",Xr="@iiif/BATCH_IMPORT",pt=(0,T.createAction)(ft)();(0,T.createAction)(Xr)();var la=(t,e)=>{let{entities:r,resource:n,mapping:o}=br(e);if(n.id===void 0)return[Zr({id:t,message:"ID is not defined in resource."})];let i=[Wr({entities:r}),ta({mapping:o})];return n.id!==t&&(i.push(ea({id:t,type:n.type})),i.push(aa({requestId:t,actualId:n.id}))),i.push(sa({id:t})),i},Or=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function ca(t,e){return!!(t===e||Or(t)&&Or(e))}function Rr(t,e){if(!Array.isArray(t)||!Array.isArray(e))return t===e;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!ca(t[r],e[r]))return!1;return!0}function lt(t,e){let r=t.iiif.requests[e],n=t.iiif.mapping[e];if(!(!n||!t.iiif.entities[n][r.resourceUri]))return t.iiif.entities[n][r.resourceUri]}function Nr(t,e,{waitTimeout:r=30}={}){return async(n,o)=>{let i=t.getState(),a=i.iiif.requests[n];if(a)switch(a.loadingState){case ut:break;case qr:{let s,l=!1;try{let p=await Promise.race([new Promise((y,h)=>{l||(s=t.subscribe(()=>{let v=t.getState();if(v.iiif.requests[n].loadingState===ut){h();return}if(v.iiif.requests[n].loadingState===dt){let x=lt(v,n);x?y(x):h()}}))}),new Promise((y,h)=>setTimeout(()=>{l=!0,h()},r*60))]);if(s&&s(),p)return p}catch{s&&s();break}break}case dt:{let s=lt(i,n);if(s)return s;break}}t.dispatch(ia({id:n}));try{let s=await e(n,o);!s.id&&!s["@id"]&&(s["@type"]&&(s["@id"]=n),s.id=n);let l=la(n,s);return t.dispatch(pt({actions:l})),lt(t.getState(),n)}catch(s){throw t.dispatch(Zr({id:n,message:s.toString()})),s}}}function ua(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}var da=(t={},e)=>{switch(e.type){case jr:return{...t,[e.payload.id]:e.payload.type};case zr:return{...t,...e.payload.mapping};default:return t}};function ct(t,e,r,n){return!(!t[r]||!t[r][e]||!t[r][e][n]||!Array.isArray(t[r][e][n]))}var pa=(t=ua(),e)=>{var r;switch(e.type){case Fr:{if(!t[e.payload.type]||!t[e.payload.type][e.payload.id])return t;let n=t[e.payload.type][e.payload.id];return typeof n=="string"?t:{...t,[e.payload.type]:{...t[e.payload.type],[e.payload.id]:{...n,[e.payload.key]:e.payload.value}}}}case Dr:{if(!ct(t,e.payload.id,e.payload.type,e.payload.key))return t;let n=t[e.payload.type][e.payload.id];if(typeof n=="string")return t;let o=Array.from(n[e.payload.key]),[i]=o.splice(e.payload.startIndex,1);return o.splice(e.payload.endIndex,0,i),{...t,[e.payload.type]:{...t[e.payload.type],[e.payload.id]:{...n,[e.payload.key]:o}}}}case Lr:{let n=Object.keys(e.payload.entities),o={...t};for(let i of n)o[i]={...t[i]||{},...e.payload.entities[i]||{}};return o}case $r:{if(!ct(t,e.payload.id,e.payload.type,e.payload.key))return t;let n=t[e.payload.type][e.payload.id],o=Array.from(n[e.payload.key]);return o.splice(e.payload.index||o.length+1,0,e.payload.reference),{...t,[e.payload.type]:{...t[e.payload.type],[e.payload.id]:{...n,[e.payload.key]:o}}}}case Vr:{if(!ct(t,e.payload.id,e.payload.type,e.payload.key))return t;let n=t[e.payload.type][e.payload.id],o=Array.from(n[e.payload.key]),i=e.payload.index||o.findIndex(a=>a&&a.id===e.payload.reference.id);return i===-1||((r=o[i])==null?void 0:r.id)!==e.payload.reference.id?t:(o.splice(i,1),{...t,[e.payload.type]:{...t[e.payload.type],[e.payload.id]:{...n,[e.payload.key]:o}}})}default:return t}},fa=(t={},e)=>{switch(e.type){case Hr:case Kr:return{...t,[e.payload.id]:{requestUri:e.payload.id,loadingState:qr,uriMismatch:!1,resourceUri:e.payload.id}};case Qr:return{...t,[e.payload.requestId]:{...t[e.payload.requestId]||{},uriMismatch:!0,resourceUri:e.payload.actualId},[e.payload.actualId]:{requestUri:e.payload.requestId,loadingState:t[e.payload.requestId].loadingState,uriMismatch:!0,resourceUri:e.payload.actualId}};case Gr:return{...t,[e.payload.id]:{...t[e.payload.id]||{},loadingState:ut,error:e.payload.message}};case Yr:return{...t,[e.payload.id]:{...t[e.payload.id]||{},loadingState:dt,error:void 0}}}return t},ma=(t={},e)=>{let{id:r,updateValue:n,value:o,meta:i,key:a}=e&&e.payload||{};switch(e.type){case _r:return{...t,[r]:{...t[r]||{},[i]:{...t[r]?t[r][i]||{}:{},[a]:o}}};case Br:return{...t,[r]:{...t[r]||{},[i]:{...t[r]?t[r][i]||{}:{},[a]:t[r]&&t[r][i]?n(t[r][i][a]):n(void 0)}}};case Ur:return t[r]&&t[r][i]&&t[r][i][a]?{...t,[r]:{...t[r]||{},[i]:{...t[r]?t[r][i]||{}:{},[a]:void 0}}}:t;default:return t}};function ha(t){return(e,r)=>r&&r.type===ft?r.payload.actions.reduce(t,e):r&&r.type===Xr?r.payload.state:t(e,r)}var ga=at({mapping:da,entities:pa,requests:fa,meta:ma}),ya=typeof window!="undefined"?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||be:be;function va(t={}){let{enableDevtools:e=!0,iiifStoreName:r="iiif",defaultState:n={},extraMiddleware:o=[],customReducers:i={}}=t,a=at({[r]:ga,...i});return it(ha(a),n,e?ya(st(...o)):be(st(...o)))}function ba(t){return{all:t=t||new Map,on:function(e,r){var n=t.get(e);n?n.push(r):t.set(e,[r])},off:function(e,r){var n=t.get(e);n&&(r?n.splice(n.indexOf(r)>>>0,1):t.set(e,[]))},emit:function(e,r){var n=t.get(e);n&&n.slice().map(function(o){o(r)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,r)})}}}var Ne=class{constructor(e,r){R(this,"options");R(this,"store");R(this,"emitter");R(this,"isBatching",!1);R(this,"batchQueue",[]);R(this,"remoteFetcher");R(this,"staticFetcher");R(this,"defaultFetcher",e=>fetch(e).then(r=>r.json()));R(this,"middleware",e=>r=>n=>{if(n.type===ft){for(let a of n.payload.actions)this.emitter.emit(a.type,{realAction:a,state:e.getState()});let i=r(n);for(let a of n.payload.actions)this.emitter.emit(`after:${n.type}`,{action:n,state:i});return i}this.emitter.emit(n.type,{action:n,state:e.getState()});let o=r(n);return this.emitter.emit(`after:${n.type}`,{action:n,state:o}),o});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=r||va({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=ba(),this.remoteFetcher=Nr(this.store,this.options.customFetcher),this.staticFetcher=Nr(this.store,(n,o)=>o)}batch(e){this.isBatching=!0;try{e(this),this.store.dispatch(pt({actions:this.batchQueue}))}catch(r){throw this.batchQueue=[],this.isBatching=!1,r}this.batchQueue=[],this.isBatching=!1}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.store.dispatch(pt({actions:this.batchQueue}))}catch(r){throw this.batchQueue=[],this.isBatching=!1,r}this.batchQueue=[],this.isBatching=!1}modifyEntityField(e,r,n){this.dispatch(Ji.modifyEntityField({id:e.id,type:e.type,key:r,value:n}))}dispatch(e){this.isBatching?this.batchQueue.push(e):this.store.dispatch(e)}serialize(e,r){return xr(this.getState().iiif,e,r)}toPresentation2(e){return this.serialize(e,Ir)}toPresentation3(e){return this.serialize(e,Ar)}hydrate(e,r){return this.get(e,r,{skipSelfReturn:!1})}get(e,r,n={}){typeof r!="string"&&(n=r||{},r=void 0);let{skipSelfReturn:o=!0}=n||{};if(Array.isArray(e))return e.map(p=>this.get(p,n));let i=this.getState();if(typeof e=="string"){let p=r||i.iiif.mapping[e];if(!p)return o?null:{id:e,type:"unknown"};e={id:e,type:p}}let a=r||e.type,s=e.id,l=i.iiif.entities[a];if(!l){let p=i.iiif.requests[s];return p&&p.resourceUri!==s?this.get(p.resourceUri,n):o?null:e}return l[e.id]||(o?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(e,r){let n=typeof e=="string"?e:e.id;return this.load(n,r)}loadCollection(e,r){let n=typeof e=="string"?e:e.id;return this.load(n,r)}load(e,r){let n=typeof e=="string"?e:e.id;return r?this.staticFetcher(n,r):this.remoteFetcher(n)}areInputsEqual(e,r){return Rr(e,r)}subscribe(e,r,n){typeof n=="undefined"&&(typeof r=="undefined"||r===!1||r===!0)&&(n=r,r=e,e=i=>i);let o=n?null:e(this.store.getState());return n||r(o,this),this.store.subscribe(()=>{let i=this.store.getState(),a=e(i);o!==a&&!Rr(o,a)&&r(a,this),o=a})}async ensureLoaded(e){let r=typeof e=="string"?e:e.id;this.requestStatus(r)||await this.load(r)}requestStatus(e){return this.select(r=>r.iiif.requests[e])}getResourceMeta(e,r){let n=this.getState().iiif.meta[e];if(!!n)return r?n[r]:n}setMetaValue([e,r,n],o){this.dispatch(typeof o=="function"?Mr.setMetaValueDynamic({id:e,meta:r,key:n,updateValue:o}):Mr.setMetaValue({id:e,meta:r,key:n,value:o}))}};var Jr={canvasBackgroundColor:"#e6e8eb",canvasHeight:"61.8vh",ignoreCaptionLabels:[],renderAbout:!0,showIIIFBadge:!0,showInformationToggle:!0,showTitle:!0},mt={activeCanvas:"",activeManifest:"",collection:{},configOptions:Jr,informationExpanded:!0,isLoaded:!1,vault:new Ne},en=oe.createContext(mt),tn=oe.createContext(mt);function Ca(t,e){switch(e.type){case"updateActiveCanvas":return e.canvasId||(e.canvasId=""),{...t,activeCanvas:e.canvasId};case"updateActiveManifest":return{...t,activeManifest:e.manifestId};case"updateCollection":return{...t,collection:e.collection};case"updateConfigOptions":return{...t,configOptions:{...Jr,...e.configOptions}};case"updateInformationExpanded":return{...t,informationExpanded:e.informationExpanded};case"updateIsLoaded":return{...t,isLoaded:e.isLoaded};default:throw new Error(`Unhandled action type: ${e.type}`)}}var rn=({initialState:t=mt,children:e})=>{let[r,n]=oe.useReducer(Ca,t);return oe.createElement(en.Provider,{value:r},oe.createElement(tn.Provider,{value:n},e))};function k(){let t=oe.useContext(en);if(t===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return t}function Q(){let t=oe.useContext(tn);if(t===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return t}import ke,{useEffect as Ut,useState as Pe}from"react";function nn(t){return t.service?`${t.service[0].id}/full/,${t.height||500}/0/default.jpg`:t.id}var ht=t=>{if(!!t)try{let e=t.thumbnail;return e&&e.length>0?nn(e[0]):nn(t.items[0].items[0].body)}catch(e){console.error("Error retrieving accompanying canvas image",e);return}};var ie=(t,e,r,n)=>{var a,s;let o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},i=l=>{if(l){if(!l.body||!l.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",l);return}if(!l.body)return;let p=l.body;Array.isArray(p)&&(p=p[0]);let y=t.get(p.id);if(!y)return;switch(r){case"painting":return l.target===e.id&&l.motivation&&l.motivation[0]==="painting"&&n.includes(y.type)&&(l.body=y),l;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};return o.canvas=t.get(e),o.canvas&&(o.annotationPage=t.get(o.canvas.items[0]),o.accompanyingCanvas=(a=o.canvas)!=null&&a.accompanyingCanvas?t.get((s=o.canvas)==null?void 0:s.accompanyingCanvas):void 0),o.annotationPage&&(o.annotations=t.get(o.annotationPage.items).filter(i)),o};var B=(t,e="en")=>{if(!t)return"";if(!t[e]){let r=Object.getOwnPropertyNames(t);if(r.length>0)return t[r[0]]}return t[e]};var gt=(t,e)=>{let r=ie(t,{id:e,type:"Canvas"},"painting",["Image","Sound","Video"]);if(r.annotations.length!==0&&r.annotations[0]&&r.annotations[0].body)return r.annotations[0].body};var yt=(t,e,r)=>{let n=t.get({id:e,type:"Canvas"});if(!(n!=null&&n.annotations)||!n.annotations[0])return[];let o=t.get(n.annotations[0]),i=t.get(o.items);return Array.isArray(i)?i.filter(a=>{var s;if(!!a.body&&(s=a.motivation)!=null&&s.includes("supplementing")){let l=a.body;Array.isArray(l)&&(l=l[0]);let p=t.get(l.id);if(p.format===r)return a.body=p,a}}).map(a=>a.body):[]};var vt=(t,e,r,n)=>{let o=[];if(e.canvas&&e.canvas.thumbnail.length>0){let s=t.get(e.canvas.thumbnail[0]);o.push(s)}if(e.annotations[0]){if(e.annotations[0].thumbnail&&e.annotations[0].thumbnail.length>0){let l=t.get(e.annotations[0].thumbnail[0]);o.push(l)}if(!e.annotations[0].body)return;let s=e.annotations[0].body;s.type==="Image"&&o.push(s)}return o.length===0?void 0:{id:o[0].id,format:o[0].format,type:o[0].type,width:r,height:n}};import{createStitches as xa}from"@stitches/react";var wa={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"#006adc",accentMuted:"#5eb0ef",accentAlt:"#00254d",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fonts:{sans:"'Inter', Arial, sans-serif",display:"'Calistoga', 'Inter', Arial, sans-serif"},transitions:{all:"all 500ms cubic-bezier(0.16, 1, 0.3, 1)"}},bt={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",xl:"(max-width: 1199px)",lg:"(min-width: 1200px)"},{styled:d,css:Al,keyframes:on,createTheme:El}=xa({theme:wa,media:bt});import*as Le from"@radix-ui/react-collapsible";var Ct=d("div",{position:"relative",zIndex:"0"}),xt=d("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),wt=d("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),an=d(Le.Trigger,{display:"none",background:"transparent",border:"none",margin:"0",padding:"0",transition:"$all",opacity:"1",marginTop:"0","&[data-navigator='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",margin:"1rem 1rem 0"}}}),It=d(Le.Content,{width:"100%",display:"flex"}),sn=d("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),ln=d("div",{display:"flex",flexDirection:"column",fontFamily:"$sans",backgroundColor:"$secondary",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${xt}`]:{flexGrow:"1"},[`& ${wt}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-navigator-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${Ct}`]:{display:"none"},[`& ${It}`]:{height:"100%"}}}});import{useEffect as Ia,useState as Sa}from"react";var cn=t=>{let e=()=>window.matchMedia?window.matchMedia(t).matches:!1,[r,n]=Sa(e);return Ia(()=>{let o=()=>n(e);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)}),r};import{useEffect as Aa,useLayoutEffect as Ea,useState as Ta}from"react";var un=(t=!1)=>{let[e,r]=Ta(t);return Ea(()=>{if(!e)return;let n=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=n}},[e]),Aa(()=>{e!==t&&r(t)},[t]),[e,r]};import*as Lo from"@radix-ui/react-collapsible";import N from"react";import{Popover as gn}from"@nulib/design-system";import*as Y from"@radix-ui/react-select";var dn=d("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),pn=d(Y.Trigger,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"$display",alignSelf:"flex-start",flexGrow:"1",backgroundColor:"$secondary",cursor:"pointer",transition:"$all",border:"1px solid $secondaryMuted",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem","@sm":{fontSize:"1rem"}}),fn=d(Y.Content,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),mn=d(Y.Item,{display:"flex",alignItems:"center",fontFamily:"$sans",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),hn=d(Y.Label,{color:"$primaryMuted",fontFamily:"$sans",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),Fe=d("div",{position:"relative",zIndex:"5"});var yn=d(gn.Trigger,{width:"30px",padding:"5px",margin:"0 0 0 2rem"}),vn=d(gn.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",fontFamily:"$sans",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none",["&:last-child"]:{marginBottom:"0"}}}),bn=d("span",{fontSize:"1.25rem",fontWeight:"700",fontFamily:"$display",alignSelf:"flex-start",flexGrow:"1",flexShrink:"0","@sm":{fontSize:"1rem"}}),Cn=d("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"flex-end",padding:"1rem",[`> ${Fe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}});import{Popover as za}from"@nulib/design-system";import V from"react";var ka=()=>{let t="#ed1d33",e="#2873ab";return V.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},V.createElement("title",null,"IIIF Manifest Options"),V.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},V.createElement("g",{transform:"scale(0.1)"},V.createElement("path",{style:{fill:e},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),V.createElement("path",{style:{fill:e},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),V.createElement("path",{style:{fill:t},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),V.createElement("path",{style:{fill:t},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),V.createElement("path",{style:{fill:e},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),V.createElement("path",{style:{fill:e},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),V.createElement("path",{style:{fill:t},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},xn=ka;import St from"react";import{useCallback as Pa,useEffect as Ma,useState as Oa}from"react";var wn=(t,e=2500)=>{let[r,n]=Oa(),o=Pa(()=>{navigator.clipboard.writeText(t).then(()=>n("copied"),()=>n("failed"))},[t]);return Ma(()=>{if(!r)return;let i=setTimeout(()=>n(void 0),e);return()=>clearTimeout(i)},[r]),[r,o]};var Ra=d("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Na=({status:t})=>t?St.createElement(Ra,{"data-copy-status":t},t):null,La=({textPrompt:t,textToCopy:e})=>{let[r,n]=wn(e);return St.createElement("button",{onClick:n},t," ",St.createElement(Na,{status:r}))},At=La;import*as P from"@radix-ui/react-select";import{Label as In,Thumbnail as Da}from"@samvera/nectar-iiif";import A from"react";import de from"react";var Fa=({direction:t,title:e})=>de.createElement(dn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},de.createElement("title",null,e),t==="up"&&de.createElement(()=>de.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),t==="down"&&de.createElement(()=>de.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),De=Fa;var $a=()=>{let t=Q(),e=k(),{activeManifest:r,collection:n,configOptions:o,vault:i}=e,a=o==null?void 0:o.canvasHeight;return A.createElement(Fe,null,A.createElement(P.Root,{value:r,onValueChange:l=>{t({type:"updateActiveManifest",manifestId:l})}},A.createElement(pn,null,A.createElement(P.Value,null),A.createElement(P.Icon,null,A.createElement(De,{direction:"down",title:"select from collection"}))),A.createElement(fn,{css:{maxHeight:`${a} !important`}},A.createElement(P.ScrollUpButton,null,A.createElement(De,{direction:"up",title:"scroll up for more"})),A.createElement(P.Viewport,null,A.createElement(P.Group,null,A.createElement(hn,null,A.createElement(In,{label:n.label})),n.items.map(l=>A.createElement(mn,{value:l.id,key:l.id},A.createElement(Da,{thumbnail:i.get(l.thumbnail)}),A.createElement(P.ItemText,null,A.createElement(In,{label:l.label})),A.createElement(P.ItemIndicator,null))))),A.createElement(P.ScrollDownButton,null,A.createElement(De,{direction:"down",title:"scroll down for more"})))))},Sn=$a;import{Label as _a}from"@samvera/nectar-iiif";import Ce,{useEffect as Va,useState as Wa}from"react";import*as $e from"@radix-ui/react-switch";var An=d($e.Root,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"$secondaryAlt",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),En=d($e.Thumb,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Tn=d("div",{display:"flex",alignItems:"center",paddingLeft:"1.618rem"}),kn=d("label",{fontSize:"0.8333rem",fontFamily:"$sans",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",color:"$primary",opacity:"0.7",paddingRight:"0.618rem"}),Pn=d("form",{});var ja=()=>{let t=Q(),[e,r]=Wa(!0);return Va(()=>{t({type:"updateInformationExpanded",informationExpanded:e})},[e]),Ce.createElement(Pn,null,Ce.createElement(Tn,null,Ce.createElement(kn,{htmlFor:"information-toggle",css:e?{opacity:"1"}:{}},"More Information"),Ce.createElement(An,{checked:e,onCheckedChange:()=>r(!e),id:"information-toggle"},Ce.createElement(En,null))))},Mn=ja;var Ba=({manifestId:t,manifestLabel:e})=>{let r=k(),{collection:n,configOptions:o}=r,{showTitle:i,showIIIFBadge:a,showInformationToggle:s}=o;return!(n!=null&&n.items)&&!i&&!a&&!s?N.createElement(N.Fragment,null):N.createElement(Cn,{className:"clover-header"},n!=null&&n.items?N.createElement(Sn,null):N.createElement(bn,null,N.createElement(_a,{label:e})),a&&N.createElement(za,null,N.createElement(yn,null,N.createElement(xn,null)),N.createElement(vn,null,(n==null?void 0:n.items)&&N.createElement("button",{onClick:l=>{l.preventDefault(),window.open(n.id,"_blank")}},"View Collection"),N.createElement("button",{onClick:l=>{l.preventDefault(),window.open(t,"_blank")}},"View Manifest")," ",(n==null?void 0:n.items)&&N.createElement(At,{textPrompt:"Copy Collection URL",textToCopy:n.id}),N.createElement(At,{textPrompt:"Copy Manifest URL",textToCopy:t}))),s&&N.createElement(Mn,null))},On=Ba;import $ from"react";import pe,{useEffect as kt,useState as Pt}from"react";import*as Rn from"@radix-ui/react-radio-group";var Nn=d(Rn.Root,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"});import O from"react";var Ua=t=>{var e=t.toString().split(":"),r=Math.ceil(parseInt(e[0])),n=Math.ceil(parseInt(e[1])),o=qa(Math.ceil(parseInt(e[2])),2);let a=`${r!==0&&n<10?(n+"").padStart(2,"0"):n}:${o}`;return r!==0&&(a=`${r}:${a}`),a},Ve=t=>{let e=new Date(t*1e3).toISOString().substr(11,8);return Ua(e)};var qa=(t,e)=>String(t).padStart(e,"0");import{Icon as xe,Tag as Ha}from"@nulib/design-system";import*as Fn from"@radix-ui/react-radio-group";import{Tag as Ln}from"@nulib/design-system";var We=d("span",{display:"flex"}),Dn=d("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),$n=d("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Vn=d(Fn.Item,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${We}`]:{position:"absolute",right:"0",bottom:"0",[`& ${Ln}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",color:"$primaryMuted",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${We}`]:{[`& ${Ln}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700",color:"$primary"}}});import{Label as Ga}from"@samvera/nectar-iiif";var Qa=({type:t})=>{switch(t){case"Sound":return O.createElement(xe.Audio,null);case"Image":return O.createElement(xe.Image,null);case"Video":return O.createElement(xe.Video,null);default:return O.createElement(xe.Image,null)}},Ya=({canvas:t,canvasIndex:e,isActive:r,thumbnail:n,type:o,handleChange:i})=>O.createElement(Vn,{"aria-checked":r,"data-testid":"media-thumbnail","data-canvas":e,onClick:()=>i(t.id),value:t.id},O.createElement("figure",null,O.createElement("div",null,(n==null?void 0:n.id)&&O.createElement("img",{src:n.id,alt:t!=null&&t.label?B(t.label):""}),O.createElement(We,null,O.createElement(Ha,{isIcon:!0,"data-testid":"thumbnail-tag"},O.createElement(Dn,null),O.createElement(xe,{"aria-label":o},O.createElement(Qa,{type:o})),["Video","Sound"].includes(o)&&O.createElement($n,null,Ve(t.duration))))),(t==null?void 0:t.label)&&O.createElement("figcaption",{"data-testid":"fig-caption"},O.createElement(Ga,{label:t.label})))),Wn=Ya;var jn=t=>t.body?t.body.type:"Image";import I,{useEffect as Xa,useState as Tt}from"react";var Et=d("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),zn=d("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"$sans",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),je=d("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),_n=d("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),Bn=d("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Et}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}});import{useEffect as Ka}from"react";var Za=(t,e)=>{Ka(()=>{function r(n){n.key===t&&e()}return window.addEventListener("keyup",r),()=>window.removeEventListener("keyup",r)},[])},Un=Za;var Ja=()=>I.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},I.createElement("title",null,"Arrow Back"),I.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),es=()=>I.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},I.createElement("title",null,"Arrow Forward"),I.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),ts=()=>I.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},I.createElement("title",null,"Close"),I.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),rs=()=>I.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},I.createElement("title",null,"Search"),I.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),ns=({handleCanvasToggle:t,handleFilter:e,activeIndex:r,canvasLength:n})=>{let[o,i]=Tt(!1),[a,s]=Tt(!1),[l,p]=Tt(!1);Xa(()=>{p(r===0),r===n-1?s(!0):s(!1)},[r]),Un("Escape",()=>{i(!1),e("")});let y=()=>{i(v=>!v),e("")};return I.createElement(Bn,{isToggle:o},I.createElement(Et,null,o&&I.createElement(zn,{autoFocus:!0,onChange:v=>e(v.target.value),placeholder:"Search"}),!o&&I.createElement(_n,null,I.createElement(je,{onClick:()=>t(-1),disabled:l,type:"button"},I.createElement(Ja,null)),I.createElement("span",null,r+1," of ",n),I.createElement(je,{onClick:()=>t(1),disabled:a,type:"button"},I.createElement(es,null))),I.createElement(je,{onClick:y,type:"button"},o?I.createElement(ts,null):I.createElement(rs,null))))},qn=ns;var os=({items:t})=>{let e=Q(),r=k(),{activeCanvas:n,vault:o}=r,[i,a]=Pt(""),[s,l]=Pt([]),[p,y]=Pt(0),h=pe.useRef(null),v="painting",x=["Image","Sound","Video"],g=u=>{n!==u&&e({type:"updateActiveCanvas",canvasId:u})};return kt(()=>{if(!s.length){let u=t.map(m=>ie(o,m,v,x)).filter(m=>m.annotations.length>0);l(u)}},[]),kt(()=>{s.forEach((u,m)=>{u!=null&&u.canvas&&u.canvas.id===n&&y(m)})},[n]),kt(()=>{let u=document.querySelector(`[data-canvas="${p}"]`);if(u instanceof HTMLElement&&h.current){let m=u.offsetLeft-h.current.offsetWidth/2+u.offsetWidth/2;h.current.scrollTo({left:m,behavior:"smooth"})}},[p]),pe.createElement(pe.Fragment,null,pe.createElement(qn,{handleFilter:u=>a(u),handleCanvasToggle:u=>{let m=s[p+u];m!=null&&m.canvas&&g(m.canvas.id)},activeIndex:p,canvasLength:s.length}),pe.createElement(Nn,{"aria-label":"select item","data-testid":"media",ref:h},s.filter(u=>{var m;if((m=u.canvas)!=null&&m.label){let b=B(u.canvas.label);if(Array.isArray(b))return b[0].toLowerCase().includes(i.toLowerCase())}}).map((u,m)=>{var b,w;return pe.createElement(Wn,{canvas:u.canvas,canvasIndex:m,handleChange:g,isActive:n===((b=u==null?void 0:u.canvas)==null?void 0:b.id),key:(w=u==null?void 0:u.canvas)==null?void 0:w.id,thumbnail:vt(o,u,200,200),type:jn(u.annotations[0])})})))},Hn=os;import D,{useEffect as Ts,useState as ks}from"react";import*as K from"@radix-ui/react-tabs";var Gn=d(K.Root,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",boxShadow:"-5px -5px 5px #00000011","@sm":{marginTop:"0.5rem",boxShadow:"none"},"&:after":{position:"absolute",bottom:0,content:"",width:"100%",height:"1rem",backgroundImage:"linear-gradient(0deg, #FFFFFF 0%, #FFFFFF00 100%)",zIndex:1,"@sm":{backgroundImage:"none"}}}),Qn=d(K.List,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid $secondaryAlt",backgroundColor:"$secondary","@sm":{margin:"0 1rem"}}),Mt=d(K.Trigger,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",color:"$primaryMuted",border:"none",fontFamily:"inherit",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:700,transition:"$all","&::after":{width:"0",height:"4px",content:"",backgroundColor:"$primaryMuted",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&:hover":{color:"$primary"},"&[data-state='active']":{color:"$accent","&::after":{width:"100%",backgroundColor:"$accent"}}}),Ot=d(K.Content,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1rem 0"}}),Yn=d("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"});import Nt,{useEffect as ls}from"react";import*as ze from"@radix-ui/react-radio-group";var Kn=on({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),Zn=d(ze.Root,{display:"flex",flexDirection:"column",width:"100%"}),_e=d(ze.Item,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"$primaryMuted",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{color:"$primary",backgroundColor:"$secondaryMuted",fontFamily:"$sansBold","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:Kn,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:Kn,boxSizing:"content-box","@sm":{content:"unset"}}}});import{v4 as is}from"uuid";var as=()=>{function t(o){return o.map(a=>{let s=a.identifier||is();return{...a,identifier:s}})}function e(o){let i=t(o);function a(l,p){let y=[];return l.forEach(h=>{let x=l.filter(g=>h.start>=g.start&&h.end<=g.end&&h.identifier!==g.identifier).sort((g,C)=>{let c=g.end-g.start,u=C.end-C.start;return c===u?0:c<u?-1:1})[0];if(!x&&!p||(x==null?void 0:x.identifier)===p){let g=a(l,h.identifier);g.length&&(h.children=g),y.push(h)}}),y}return a(i,null)}function r(o,i=[]){return i.some(a=>o.start>=a.start&&o.end<=a.end)}function n(o=[]){return o.sort((i,a)=>i.start-a.start)}return{addIdentifiersToParsedCues:t,createNestedCues:e,isChild:r,orderCuesByTime:n}},Xn=as;import Ue from"react";import Rt from"react";import Be from"react";var Jn={currentTime:0,startTime:0,updateStartTime:()=>{},updateCurrentTime:()=>{}},we=Be.createContext(Jn),eo=({children:t})=>{let[e,r]=Be.useState(Jn.currentTime),[n,o]=Be.useState(0),i=s=>o(s),a=s=>r(s);return Be.createElement(we.Provider,{value:{currentTime:e,startTime:n,updateStartTime:i,updateCurrentTime:a}},t)};var ss=({label:t,start:e,end:r})=>{let{currentTime:n,updateStartTime:o}=Rt.useContext(we),i=e<=n&&n<r;return Rt.createElement(_e,{"aria-checked":i,"data-testid":"navigator-cue",onClick:()=>{o(e)},value:t},t,Rt.createElement("strong",null,Ve(e)))},to=ss;var ro=d("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${_e}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}});var no=({items:t})=>Ue.createElement(ro,null,t.map(({text:e,start:r,end:n,children:o,identifier:i})=>Ue.createElement("li",{key:i},Ue.createElement(to,{label:e,start:r,end:n}),o&&Ue.createElement(no,{items:o})))),oo=no;import{parse as cs}from"node-webvtt";var us=({resource:t})=>{let[e,r]=Nt.useState([]),{id:n,label:o}=t,{createNestedCues:i,orderCuesByTime:a}=Xn();return ls(()=>{fetch(n,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(s=>s.text()).then(s=>{let l=cs(s).cues,p=a(l),y=i(p);r(y)}).catch(s=>console.error(n,s.toString()))},[n]),Nt.createElement(Zn,{"aria-label":`navigate ${B(o,"en")}`},Nt.createElement(oo,{items:e}))},io=us;import{Label as Ps}from"@samvera/nectar-iiif";var ao=d("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",color:"$primary",fontFamily:"$sans",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),so=d("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"});import{Homepage as ds}from"@samvera/nectar-iiif";import fe from"react";var ps=({homepage:t})=>(t==null?void 0:t.length)===0?fe.createElement(fe.Fragment,null):fe.createElement(fe.Fragment,null,fe.createElement("span",{className:"manifest-property-title"},"Homepage"),fe.createElement(ds,{homepage:t})),Lt=ps;import qe from"react";var fs=({id:t,htmlLabel:e,parent:r="manifest"})=>qe.createElement(qe.Fragment,null,qe.createElement("span",{className:"manifest-property-title"},e),qe.createElement("a",{href:t,target:"_blank",id:`iiif-${r}-id`},t)),Ft=fs;import Ie from"react";import{Metadata as ms}from"@samvera/nectar-iiif";var hs=({metadata:t,parent:e="manifest"})=>t?Ie.createElement(Ie.Fragment,null,Ie.createElement(ms,{metadata:t,id:`iiif-${e}-metadata`})):Ie.createElement(Ie.Fragment,null),Dt=hs;import Se from"react";import{RequiredStatement as gs}from"@samvera/nectar-iiif";var ys=({requiredStatement:t,parent:e="manifest"})=>t?Se.createElement(Se.Fragment,null,Se.createElement(gs,{requiredStatement:t,id:`iiif-${e}-required-statement`})):Se.createElement(Se.Fragment,null),$t=ys;import me from"react";var vs=({rights:t})=>t?me.createElement(me.Fragment,null,me.createElement("span",{className:"manifest-property-title"},"Rights"),me.createElement("a",{href:t,target:"_blank"},t)):me.createElement(me.Fragment,null),Vt=vs;import{SeeAlso as bs}from"@samvera/nectar-iiif";import he from"react";var Cs=({seeAlso:t})=>(t==null?void 0:t.length)===0?he.createElement(he.Fragment,null):he.createElement(he.Fragment,null,he.createElement("span",{className:"manifest-property-title"},"See Also"),he.createElement(bs,{seeAlso:t})),Wt=Cs;import Ae from"react";import{Summary as xs}from"@samvera/nectar-iiif";var ws=({summary:t,parent:e="manifest"})=>t?Ae.createElement(Ae.Fragment,null,Ae.createElement(xs,{summary:t,as:"p",id:`iiif-${e}-summary`})):Ae.createElement(Ae.Fragment,null),jt=ws;import Ee from"react";import{Thumbnail as Is}from"@samvera/nectar-iiif";var Ss=({label:t,thumbnail:e})=>(e==null?void 0:e.length)===0?Ee.createElement(Ee.Fragment,null):Ee.createElement(Ee.Fragment,null,Ee.createElement(Is,{altAsLabel:t||{none:["resource"]},thumbnail:e})),zt=Ss;import F,{useEffect as As,useState as He}from"react";var Es=()=>{let t=k(),{activeManifest:e,vault:r}=t,[n,o]=He(),[i,a]=He([]),[s,l]=He([]),[p,y]=He([]);return As(()=>{var v,x,g;let h=r.get(e);o(h),((v=h.homepage)==null?void 0:v.length)>0&&a(r.get(h.homepage)),((x=h.seeAlso)==null?void 0:x.length)>0&&l(r.get(h.seeAlso)),((g=h.thumbnail)==null?void 0:g.length)>0&&y(r.get(h.thumbnail))},[e,r]),n?F.createElement(so,null,F.createElement(ao,null,F.createElement(zt,{thumbnail:p,label:n.label}),F.createElement(jt,{summary:n.summary}),F.createElement(Dt,{metadata:n.metadata}),F.createElement($t,{requiredStatement:n.requiredStatement}),F.createElement(Vt,{rights:n.rights}),F.createElement(Lt,{homepage:i}),F.createElement(Wt,{seeAlso:s}),F.createElement(Ft,{id:n.id,htmlLabel:"IIIF Manifest"}))):F.createElement(F.Fragment,null)},lo=Es;var Ms=({activeCanvas:t,resources:e})=>{let r=k(),{configOptions:n}=r,{renderAbout:o}=n,[i,a]=ks();Ts(()=>{o?a("manifest-about"):e&&(e==null?void 0:e.length)>0&&!o&&a(e[0].id)},[t,e]);let s=l=>{a(l)};return e?D.createElement(Gn,{"data-testid":"navigator",defaultValue:i,onValueChange:s,orientation:"horizontal",value:i},D.createElement(Qn,{"aria-label":"select chapter","data-testid":"navigator-list"},o&&D.createElement(Mt,{value:"manifest-about"},"About"),e&&e.map(({id:l,label:p})=>D.createElement(Mt,{key:l,value:l},D.createElement(Ps,{label:p})))),D.createElement(Yn,null,o&&D.createElement(Ot,{value:"manifest-about"},D.createElement(lo,null)),e&&e.map(l=>D.createElement(Ot,{key:l.id,value:l.id},D.createElement(io,{resource:l}))))):D.createElement(D.Fragment,null)},co=Ms;import U from"react";import Te from"hls.js";var uo=d("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",display:"flex",position:"relative",objectFit:"contain",width:"100%",height:"100%",zIndex:"1"}});import Ge from"react";var po=d("canvas",{position:"absolute",width:"100%",height:"100%"});var Os=Ge.forwardRef((t,e)=>{let r=Ge.useRef(null);Ge.useEffect(()=>{!e||(e.current.onplay=n)},[e]);function n(){let i=e.current,a=new AudioContext,s=a.createMediaElementSource(i),l=a.createAnalyser(),p=r.current;if(!p)return;p.width=i.offsetWidth,p.height=i.offsetHeight;let y=p.getContext("2d");s.connect(l),l.connect(a.destination),l.fftSize=256;let h=l.frequencyBinCount,v=new Uint8Array(h);setInterval(function(){o(l,y,h,v,p.width,p.height)},20)}function o(i,a,s,l,p,y){let h=p/s*2.6,v,x=0;i.getByteFrequencyData(l),a.fillStyle="#000000",a.fillRect(0,0,p,y);for(let g=0;g<s;g++)v=l[g]*2,a.fillStyle=`rgba(${78}, 42, 132, 1)`,a.fillRect(x,y-v,h,v),x+=h+6}return Ge.createElement(po,{ref:r})}),fo=Os;import Rs from"react";var Ns=({resource:t,ignoreCaptionLabels:e})=>{let r=B(t.label,"en");return r.some(o=>e.includes(o))?null:Rs.createElement("track",{key:t.id,src:t.id,label:r,srcLang:"en","data-testid":"player-track"})},mo=Ns;var Ls=({painting:t,resources:e})=>{var x;let r=U.useRef(null),n=(x=t==null?void 0:t.format)==null?void 0:x.includes("audio/"),{startTime:o,updateCurrentTime:i}=U.useContext(we),a=k(),{activeCanvas:s,configOptions:l,vault:p}=a,y=ie(p,{id:s,type:"Canvas"},"painting",["Image"]),h=ht(y.accompanyingCanvas);U.useEffect(()=>{if(!t.id||!r.current||t.id.split(".").pop()!=="m3u8")return;let g=new Te;return g.attachMedia(r.current),g.on(Te.Events.MEDIA_ATTACHED,function(){g.loadSource(t.id)}),g.on(Te.Events.ERROR,function(C,c){if(c.fatal)switch(c.type){case Te.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${C} network error encountered, try to recover`),g.startLoad();break;case Te.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${C} media error encountered, try to recover`),g.recoverMediaError();break;default:g.destroy();break}}),()=>{g&&(g.detachMedia(),g.destroy(),i(0))}},[t.id]),U.useEffect(()=>{let g=r.current;g&&(g.currentTime=o),o!==0&&g.play()},[o]);let v=()=>{let g=r.current;g&&(g.ontimeupdate=C=>{i(C.target.currentTime)})};return U.createElement(uo,{css:{backgroundColor:l.canvasBackgroundColor,maxHeight:l.canvasHeight}},U.createElement("video",{id:"clover-iiif-video",key:t.id,ref:r,controls:!0,height:t.height,width:t.width,onPlay:v,crossOrigin:"anonymous",poster:h},U.createElement("source",{src:t.id,type:t.format}),e.length>0&&e.map(g=>U.createElement(mo,{resource:g,ignoreCaptionLabels:l.ignoreCaptionLabels,key:g.id})),"Sorry, your browser doesn't support embedded videos."),n&&U.createElement(fo,{ref:r}))},ho=Ls;import js,{useEffect as zs,useState as To}from"react";import Ye,{useEffect as So,useState as $s}from"react";import Ao from"openseadragon";var go=d("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"}}),yo=d("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),vo=d("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"});import L from"react";import _t from"react";var bo=d("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"#000D",filter:"drop-shadow(5px 5px 5px #0006)",transition:"$all",boxSizing:"content-box !important",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(5px 5px 5px #000D)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#zoomReset":{"&:hover, &:focus":{svg:{rotate:"45deg"}}}});var Fs=({id:t,label:e,children:r})=>_t.createElement(bo,{id:t,"data-testid":"openseadragon-button"},_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},_t.createElement("title",{id:`${t}-svg-title`},e),r)),Qe=Fs;var Co=d("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem"});var Ds=()=>L.createElement(Co,{"data-testid":"openseadragon-controls",id:"openseadragon-controls"},L.createElement(Qe,{id:"zoomIn",label:"zoom in"},L.createElement(()=>L.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),null)),L.createElement(Qe,{id:"zoomOut",label:"zoom in"},L.createElement(()=>L.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),null)),L.createElement(Qe,{id:"zoomReset",label:"reset zoom"},L.createElement(()=>L.createElement(L.Fragment,null,L.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),L.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),null))),xo=Ds;var wo=t=>fetch(`${t.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(e=>{console.error(`The IIIF tilesource ${t.replace(/\/$/,"")}/info.json failed to load: ${e}`)}),Io=t=>{let e,r;if(Array.isArray(t)&&(e=t[0],e)){let n;"@id"in e?n=e["@id"]:n=e.id,r=n}return r};import{v4 as Vs}from"uuid";var Ws=({uri:t,imageType:e})=>{let[r,n]=$s(),o=k(),{configOptions:i}=o,a=Vs(),s={id:`openseadragon-viewport-${a}`,loadTilesWithAjax:!0,homeButton:"zoomReset",showFullPageControl:!1,zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${a}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}};return So(()=>{t!==r&&n(t)},[]),So(()=>{if(r)switch(e){case"simpleImage":Ao(s).addSimpleImage({url:r});break;case"tiledImage":wo(r).then(l=>Ao(s).addTiledImage({tileSource:l}));break;default:console.warn(`Unable to render ${r} in OpenSeadragon as type: "${e}"`);break}},[r]),Ye.createElement(vo,{css:{backgroundColor:i.canvasBackgroundColor,height:i.canvasHeight}},Ye.createElement(xo,null),Ye.createElement(go,{id:`openseadragon-navigator-${a}`}),Ye.createElement(yo,{id:`openseadragon-viewport-${a}`}))},Eo=Ws;var _s=({body:t})=>{let[e,r]=To(),[n,o]=To();return zs(()=>{Array.isArray(t.service)&&t.service.length>0?(r("tiledImage"),o(Io(t.service))):(r("simpleImage"),o(t.id))},[t]),js.createElement(Eo,{uri:n,key:n,imageType:e})},ko=_s;import{Button as Bs}from"@nulib/design-system";var Us=({activeCanvas:t,painting:e,resources:r,items:n,isAbout:o,isInformation:i,isNavigator:a,isNavigatorOpen:s,isMedia:l})=>$.createElement(xt,{className:"clover-content"},$.createElement(eo,null,$.createElement(wt,null,l?$.createElement(ho,{painting:e,resources:r}):e&&$.createElement(ko,{body:e,key:t}),$.createElement(an,null,$.createElement(Bs,{as:"span"},s?"View Items":"More Information")),n.length>1&&$.createElement(Ct,{className:"clover-canvases"},$.createElement(Hn,{items:n,activeItem:0}))),i&&(o||a)&&$.createElement(sn,null,$.createElement(It,null,$.createElement(co,{activeCanvas:t,resources:r}))))),Po=Us;import Bt from"react";var Mo=d("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Oo=d("p",{fontFamily:"$display",fontWeight:"bold",fontSize:"x-large"}),Ro=d("span",{fontSize:"medium"});var qs=({error:t})=>{let{message:e}=t;return Bt.createElement(Mo,{role:"alert"},Bt.createElement(Oo,{"data-testid":"headline"},"Something went wrong"),e&&Bt.createElement(Ro,null,`Error message: ${e}`," "))},No=qs;import{ErrorBoundary as Hs}from"react-error-boundary";var Gs=({manifest:t,theme:e})=>{let r=k(),{activeCanvas:n,informationExpanded:o,vault:i,configOptions:a}=r,[s,l]=Pe(!1),[p,y]=Pe(!1),[h,v]=Pe(!0),[x,g]=Pe(void 0),[C,c]=Pe([]),[u,m]=un(!1),b=cn(bt.sm);return Ut(()=>{if(!b){v(!0);return}v(!1)},[b]),Ut(()=>{if(!b){m(!1);return}m(h)},[h]),Ut(()=>{let w=gt(i,n),S=yt(i,n,"text/vtt");w&&(l(["Sound","Video"].indexOf(w.type)>-1),g({...w})),c(S),y(S.length!==0)},[n]),ke.createElement(Hs,{FallbackComponent:No},ke.createElement(ln,{className:`${e} clover-iiif`,"data-body-locked":u,"data-navigator":p,"data-navigator-open":h},ke.createElement(Lo.Root,{open:h,onOpenChange:v},ke.createElement(On,{manifestLabel:t.label,manifestId:t.id}),ke.createElement(Po,{activeCanvas:n,painting:x,resources:C,items:t.items,isAbout:a.renderAbout,isMedia:s,isInformation:o,isNavigator:p,isNavigatorOpen:h}))))},Fo=Gs;import{createTheme as Qs}from"@stitches/react";var Ys=({canvasIdCallback:t=()=>{},customTheme:e,id:r,manifestId:n,options:o})=>q.createElement(rn,null,q.createElement(Ks,{id:r,manifestId:n,canvasIdCallback:t,customTheme:e,options:o})),Ks=({canvasIdCallback:t,customTheme:e,id:r,manifestId:n,options:o})=>{let i=Q(),a=k(),{activeCanvas:s,activeManifest:l,isLoaded:p,vault:y}=a,[h,v]=Do(),[x,g]=Do(),C={};return e&&(C=Qs("custom",e)),Ke(()=>{t&&t(s)},[s]),Ke(()=>{l&&y.loadManifest(l).then(c=>{g(c),i({type:"updateActiveCanvas",canvasId:c.items[0]&&c.items[0].id})}).catch(c=>{console.error(`Manifest failed to load: ${c}`)}).finally(()=>{i({type:"updateIsLoaded",isLoaded:!0})})},[l]),Ke(()=>{let c=r;n&&(c=n),i({type:"updateConfigOptions",configOptions:o}),y.load(c).then(u=>{v(u)}).catch(u=>{console.error(`The IIIF resource ${c} failed to load: ${u}`)})},[r,o]),Ke(()=>{let c=[];(h==null?void 0:h.type)==="Collection"?(i({type:"updateCollection",collection:h}),c=h.items.filter(u=>u.type==="Manifest").map(u=>u.id),c.length>0&&i({type:"updateActiveManifest",manifestId:c[0]})):(h==null?void 0:h.type)==="Manifest"&&i({type:"updateActiveManifest",manifestId:h.id})},[h]),p?!x||!x.items?(console.log(`The IIIF manifest ${n} failed to load.`),q.createElement(q.Fragment,null)):x.items.length===0?(console.log(`The IIIF manifest ${n} does not contain canvases.`),q.createElement(q.Fragment,null)):q.createElement(Fo,{manifest:x,theme:C,key:x.id}):q.createElement(q.Fragment,null,"Loading")},Wp=Ys;export{Wp as default};
//# sourceMappingURL=index.esm.js.map
